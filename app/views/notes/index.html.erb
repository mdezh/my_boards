<%= turbo_frame_tag 'notes_frame' do %>

  <% if @board %>
    <%= turbo_stream_from [@board, :notes] %>
    <%= turbo_stream_from [current_user, @board] %>

    <%= render 'shared/state', id: 'board_state', value: {
      public_rw: @board.public_rw?,
    } %>

    <%= render 'shared/state', id: 'user_board_state', value: {
      owned: @board.owned_by_user?(current_user),
      joined: @board.joined_by_user?(current_user)
    } %>

    <%= render 'shared/state', id: 'details_state', value: {
      show_details: false
    } %>

    <%= render 'shared/state_counter', id: 'notes_counter', value: @notes.size %>
  <% end %>

  <div class="full-column d-flex flex-column">
      <% rounded = 'rounded' %>
      <% if @board %>
        <%= render 'notes_panel_header' %>
        <%= render 'board_details_header', board: @board, owned: @owned %>
        <% rounded = 'rounded-bottom' %>
      <% end %>
      <div class="d-flex flex-column-reverse flex-grow-1 overflow-auto shadow <%= rounded %> border text-bg-light">
        <% if @board %>
          <%= tag.div class: 'd-flex flex-column-reverse flex-grow-1 overflow-auto', data: {
            controller: 'state-driven',
            state_driven_state_selector_value: '#details_state',
            state_driven_key_value: 'show_details',
            state_driven_not_value: true
          } do %>
            <%= render 'no_notes' %>
            <div id="notes" class="overflow-auto list-group list-group-flush d-flex flex-column-reverse" >
              <%= render @notes %>
              <div id="notes_spinner" class="my-5 text-secondary text-center invisible hidden">
                <div class="spinner-grow" role="status">
                  <span class="visually-hidden">Loading...</span>
                </div>
              </div>
            </div>
          <% end %>
          <%= render 'board_details', board: @board %>
        <% else %>
          <%= render 'not_selected' %>
        <% end %>
      </div>
      <% if @board %>
        <%= tag.div data: {
          controller: 'state-driven',
          state_driven_state_selector_value: '#details_state',
          state_driven_key_value: 'show_details',
          state_driven_not_value: true,
        } do %>
          <%= render 'add_form', board: @board, owned: @owned, joined: @joined %>
        <% end %>
        <%= render 'boards/join_btn', board: @board, belongs: @owned || @joined %>
      <% end %>
  </div>

<% end %>
